{% extends "home.html" %}

{% block content %}
<div class="box box-primary">
    <div class="box-header with-border">
    </div>
    <div class="box-body">

        <form action="/managment" method="Post" role="form">
        <div class="col-md-6">
            <div class="form-group">
                <label>{{form.usertype_select.label}}</label>
                {{form.usertype_select(class_="form-control select2",placeholder="please select")}}
            </div>
            <div class="form-group">
                    {{form.search()}}
            </div>

        </div>
    </form>
        {% if users%}
        <table class="table table-bordered">
            <tr>
                <th>User Name</th>
                <th>Email</th>
                <th>phone</th>
                <th>birth</th>
                <th>status</th>
                <th>reset password</th>
                <th>user_type</th>
            </tr>
            {% for row in users %}
            <tr>
                <td>{{row.username}}</td>
                <td>{{row.email}}</td>
                <td>{{row.phone}}</td>
                <td>{{row.birth}}</td>
                <td>
                        {% if row.id == current_user.id %}
                        {% else %}
                            {% if row.status == 1 %}
                            <input type="checkbox" data-id="{{row.id}}" class="status" data-on-text="active" data-off-text="inactive"
                                data-size="mini" checked>
                            {% else %}
                            <input type="checkbox" data-id="{{row.id}}" class="status" data-on-text="active" data-off-text="inactive"
                                data-size="mini">
                            {% endif %}
                        {% endif %}
                </td>
                <td>
                        {% if row.user_type == 2 %}
                            <form action="{{ url_for('user.profile', user_id=row.id) }}" method="POST">
                                <input class="fa " type="submit" value="reset password">
                        {% else %}
                        {% endif %}
                </form>
                </td>

                {% if row.user_type == 1 %}
                <td>Admin</td>
                {% elif row.user_type ==  2%}
                <td>User</td>
                {% else%}
                <td></td>
                {% endif %}
            </tr>
            {% endfor %}
        </table>
        {% endif %}
    </div>
    
</div>
{% endblock %}


{% block scripts %}
<script>
    function initPage() {

        $('.status').bootstrapSwitch();
        $(".status").on("switchChange.bootstrapSwitch", function (event, state) {
            switchStatus($(this).data("id"), state?1:0, this);
        });
    }
    function switchStatus(id, status, switchBox) {
        restTemplate("POST", "/users/" + id + "/status/" + status, null, function () {
            $($(switchBox)).bootstrapSwitch("state", status);
        });
    }
</script>
{% endblock %}